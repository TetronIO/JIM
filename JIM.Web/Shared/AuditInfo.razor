@using JIM.Models.Activities
@using JIM.Models.Interfaces

@* Standardised audit info display for IAuditable configuration objects.
   Shows Created and Last Updated as compact chips with tooltips and principal links. *@

<div class="d-flex flex-wrap gap-2 align-center">
    <MudTooltip Text="@Entity.Created.ToLocalTime().ToFriendlyDate()" Arrow="true" Placement="Placement.Top">
        <MudChip T="string" Variant="Variant.Text" Size="Size.Small" Color="Color.Default"
                 Icon="@Icons.Material.Outlined.Schedule">
            Created @Entity.Created.ToLocalTime().ToRelativeTime()@if (Entity.CreatedByType != ActivityInitiatorType.NotSet)
            {<text> by&nbsp;</text><AuditPrincipalLink PrincipalType="@Entity.CreatedByType"
                        PrincipalId="@Entity.CreatedById"
                        PrincipalName="@Entity.CreatedByName" />}
        </MudChip>
    </MudTooltip>

    @if (Entity.LastUpdated.HasValue)
    {
        <MudTooltip Text="@Entity.LastUpdated.Value.ToLocalTime().ToFriendlyDate()" Arrow="true" Placement="Placement.Top">
            <MudChip T="string" Variant="Variant.Text" Size="Size.Small" Color="Color.Default"
                     Icon="@Icons.Material.Outlined.Edit">
                Updated @Entity.LastUpdated.Value.ToLocalTime().ToRelativeTime()@if (Entity.LastUpdatedByType != ActivityInitiatorType.NotSet)
                {<text> by&nbsp;</text><AuditPrincipalLink PrincipalType="@Entity.LastUpdatedByType"
                            PrincipalId="@Entity.LastUpdatedById"
                            PrincipalName="@Entity.LastUpdatedByName" />}
            </MudChip>
        </MudTooltip>
    }
</div>

@code {
    /// <summary>
    /// The auditable entity whose Created/LastUpdated fields should be displayed.
    /// </summary>
    [Parameter, EditorRequired]
    public IAuditable Entity { get; set; } = null!;
}
