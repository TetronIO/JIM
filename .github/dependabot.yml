# Dependabot configuration for JIM
# Automatically manages dependency updates for NuGet packages, Docker images, and GitHub Actions
version: 2
updates:
  # .NET NuGet dependencies
  - package-ecosystem: "nuget"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/London"
    open-pull-requests-limit: 10
    reviewers:
      - "TetronIO/jim-maintainers"
    commit-message:
      prefix: "chore"
      include: "scope"
    ignore:
      # Ignore all major version updates
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
    groups:
      # Group .NET runtime and SDK updates together
      dotnet-runtime:
        patterns:
          - "Microsoft.NETCore.*"
          - "Microsoft.AspNetCore.*"
          - "Microsoft.Extensions.*"
      # Group EF Core updates together
      entity-framework:
        patterns:
          - "Microsoft.EntityFrameworkCore*"
          - "Npgsql.EntityFrameworkCore*"
      # Group testing dependencies
      testing:
        patterns:
          - "NUnit*"
          - "Moq*"
          - "coverlet*"
          - "Microsoft.NET.Test.Sdk"
      # Group Blazor/UI dependencies
      blazor-ui:
        patterns:
          - "MudBlazor*"
          - "Microsoft.AspNetCore.Components*"
      # Group Azure Functions dependencies
      azure-functions:
        patterns:
          - "Microsoft.Azure.Functions*"
          - "Microsoft.Azure.WebJobs*"

  # Docker base images (digest-pinned for reproducible builds)
  # Dependabot will propose PRs to update digests when new images are published.
  # IMPORTANT: When a digest update is merged, you must also update the pinned
  # apt package versions in the corresponding Dockerfile to match the new base image.
  # Run: docker run --rm <image>@<new-digest> bash -c "apt-get update -qq && apt-cache policy <pkg>"
  - package-ecosystem: "docker"
    directory: "/JIM.Web"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/London"
    reviewers:
      - "TetronIO/jim-maintainers"
    commit-message:
      prefix: "chore"
      include: "scope"
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
    groups:
      dotnet-base-images:
        patterns:
          - "mcr.microsoft.com/dotnet/*"

  - package-ecosystem: "docker"
    directory: "/JIM.Worker"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/London"
    reviewers:
      - "TetronIO/jim-maintainers"
    commit-message:
      prefix: "chore"
      include: "scope"
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
    groups:
      dotnet-base-images:
        patterns:
          - "mcr.microsoft.com/dotnet/*"

  - package-ecosystem: "docker"
    directory: "/JIM.Scheduler"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/London"
    reviewers:
      - "TetronIO/jim-maintainers"
    commit-message:
      prefix: "chore"
      include: "scope"
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
    groups:
      dotnet-base-images:
        patterns:
          - "mcr.microsoft.com/dotnet/*"

  # GitHub Actions
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "Europe/London"
    reviewers:
      - "TetronIO/jim-maintainers"
    commit-message:
      prefix: "chore"
    ignore:
      # Ignore all major version updates
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
