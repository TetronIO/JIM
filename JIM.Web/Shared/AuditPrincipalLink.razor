@using JIM.Application
@using JIM.Models.Activities
@inject JimApplication Jim

@if (PrincipalType == ActivityInitiatorType.User && PrincipalId.HasValue)
{
    @if (_mvoHref != null)
    {
        <MudLink Href="@_mvoHref">@(PrincipalName ?? PrincipalId.ToString())</MudLink>
    }
    else
    {
        <MudText Typo="Typo.body2">@(PrincipalName ?? PrincipalId.ToString())</MudText>
    }
}
else if (PrincipalType == ActivityInitiatorType.ApiKey && PrincipalId.HasValue)
{
    <MudLink Href="@($"/admin/apikeys/{PrincipalId}")">@(PrincipalName ?? "API Key")</MudLink>
}
else if (PrincipalType == ActivityInitiatorType.System)
{
    <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small" Class="mr-1" Style="vertical-align: middle;" />
    <MudText Typo="Typo.body2" Inline="true">System</MudText>
}
else
{
    <MudText Typo="Typo.body2" Class="mud-text-secondary">--</MudText>
}

@code {
    [Parameter] public ActivityInitiatorType PrincipalType { get; set; }
    [Parameter] public Guid? PrincipalId { get; set; }
    [Parameter] public string? PrincipalName { get; set; }

    private string? _mvoHref;

    protected override async Task OnParametersSetAsync()
    {
        _mvoHref = null;

        if (PrincipalType == ActivityInitiatorType.User && PrincipalId.HasValue)
        {
            var mvo = await Jim.Metaverse.GetMetaverseObjectAsync(PrincipalId.Value);
            if (mvo?.Type != null)
            {
                _mvoHref = $"/t/{mvo.Type.PluralName.ToLower()}/v/{mvo.Id}";
            }
        }
    }
}
